<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My SSH Client</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="../node_modules/xterm/css/xterm.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- 타이틀바 -->
  <div class="titlebar">
    <div class="titlebar-drag">
      <i data-lucide="terminal" class="app-icon"></i>
      <span class="app-title">My SSH Client</span>
    </div>
    <div class="titlebar-buttons">
      <button class="btn-minimize" onclick="electronAPI.minimizeWindow()"><i data-lucide="minus" class="icon-sm"></i></button>
      <button class="btn-maximize" onclick="electronAPI.maximizeWindow()"><i data-lucide="square" class="icon-sm"></i></button>
      <button class="btn-close" onclick="electronAPI.closeWindow()"><i data-lucide="x" class="icon-sm"></i></button>
    </div>
  </div>

  <!-- 메인 컨테이너 -->
  <div class="main-container">
    <!-- 사이드바 -->
    <div class="sidebar">
      <div class="sidebar-header">
        <button class="btn-new-session" onclick="showConnectModal()">
          <i data-lucide="plus" class="icon-sm"></i> 새 연결
        </button>
        <button class="btn-new-folder" onclick="createNewFolder()" title="새 폴더">
          <i data-lucide="folder-plus" class="icon-sm"></i>
        </button>
      </div>
      <div class="session-list" id="sessionList">
        <!-- 세션 목록이 여기에 추가됨 -->
        <div class="empty-state">
          <p>저장된 세션이 없습니다</p>
          <p class="hint">새 연결을 추가하세요</p>
        </div>
      </div>
    </div>

    <!-- 터미널 영역 -->
    <div class="terminal-area">
      <!-- 터미널 컨텐트 (탭바 + 화면 + 분할) -->
      <div class="terminal-content">
        <!-- 탭 바 -->
        <div class="tab-bar" id="tabBar">
          <div class="tabs" id="tabs">
            <!-- 탭이 여기에 추가됨 -->
          </div>
          <div class="tab-actions">
            <button class="btn-sftp-toggle" id="btnSftpToggle" onclick="toggleSftpPanel()" title="SFTP" disabled>
              <i data-lucide="folder" class="icon-sm"></i> SFTP
            </button>
          </div>
        </div>

        <!-- 환영 화면 -->
        <div class="welcome-screen" id="welcomeScreen">
          <div class="welcome-content">
            <h1><i data-lucide="terminal"></i> My SSH Client</h1>
            <p>새 연결을 추가하거나 저장된 세션을 선택하세요</p>
            <button class="btn-primary" onclick="showConnectModal()">
              새 SSH 연결
            </button>
          </div>
        </div>

        <!-- 분할 컨테이너 -->
        <div class="split-container" id="splitContainer" style="display: none; flex: 1; height: 100%;">
          <div class="split-panel active" id="panel-1" data-panel-id="1" style="flex: 1; height: 100%; display: flex; flex-direction: column;">
            <div class="panel-header">
              <span class="panel-title" id="panelTitle-1">터미널</span>
              <button class="btn-panel-close" onclick="closePanel('1')" title="패널 닫기"><i data-lucide="x" class="icon-sm"></i></button>
            </div>
            <div class="terminal-wrapper" id="terminal-panel-1" style="flex: 1; display: block; min-height: 200px;"></div>
          </div>
        </div>

        <!-- 드래그 드롭 존 오버레이 -->
        <div class="drop-zone-overlay" id="dropZoneOverlay" style="display: none;">
          <div class="drop-zone drop-zone-left" data-direction="left"></div>
          <div class="drop-zone drop-zone-right" data-direction="right"></div>
          <div class="drop-zone drop-zone-top" data-direction="top"></div>
          <div class="drop-zone drop-zone-bottom" data-direction="bottom"></div>
          <div class="drop-zone drop-zone-center" data-direction="center"></div>
        </div>
      </div>

      <!-- SFTP 패널 (하단) -->
      <div class="sftp-panel-bottom" id="sftpPanel" style="display: none;">
      <div class="sftp-resize-handle" id="sftpResizeHandle"></div>

      <div class="sftp-container">
        <!-- 로컬 파일 패널 -->
        <div class="sftp-local-panel">
          <div class="sftp-header">
            <span class="panel-label">로컬</span>
            <div class="sftp-path">
              <button class="btn-sftp-up" onclick="localGoUp()" title="상위 폴더"><i data-lucide="arrow-up" class="icon-sm"></i></button>
              <input type="text" id="localPath" value="" onkeypress="if(event.key==='Enter')localNavigate()" readonly>
              <button class="btn-sftp-refresh" onclick="localRefresh()" title="새로고침"><i data-lucide="refresh-cw" class="icon-sm"></i></button>
            </div>
          </div>
          <div class="sftp-file-list" id="localFileList"
               ondragstart="localDragStart(event)"
               ondragover="localDragOver(event)"
               ondragleave="localDragLeave(event)"
               ondrop="localDrop(event)">
            <div class="sftp-empty">로컬 폴더를 선택하세요</div>
          </div>
        </div>

        <!-- 중앙 구분선 -->
        <div class="sftp-divider"></div>

        <!-- 원격 파일 패널 -->
        <div class="sftp-remote-panel">
          <div class="sftp-header">
            <span class="panel-label">원격</span>
            <div class="sftp-path">
              <button class="btn-sftp-up" onclick="sftpGoUp()" title="상위 폴더"><i data-lucide="arrow-up" class="icon-sm"></i></button>
              <input type="text" id="sftpPath" value="/" onkeypress="if(event.key==='Enter')sftpNavigate()">
              <button class="btn-sftp-go" onclick="sftpNavigate()" title="이동"><i data-lucide="arrow-right" class="icon-sm"></i></button>
              <button class="btn-sftp-refresh" onclick="sftpRefresh()" title="새로고침"><i data-lucide="refresh-cw" class="icon-sm"></i></button>
            </div>
            <div class="sftp-toolbar">
              <button onclick="sftpNewFolder()" title="새 폴더"><i data-lucide="folder-plus" class="icon-sm"></i></button>
              <button onclick="sftpDeleteSelected()" title="삭제"><i data-lucide="trash-2" class="icon-sm"></i></button>
            </div>
          </div>
          <div class="sftp-file-list" id="sftpFileList"
               ondragstart="sftpDragStart(event)"
               ondragover="sftpDragOver(event)"
               ondragleave="sftpDragLeave(event)"
               ondrop="sftpDrop(event)">
            <div class="sftp-empty">SFTP 연결 후 파일이 표시됩니다</div>
          </div>
          <div class="sftp-drop-overlay" id="sftpDropOverlay">
            <div class="drop-message"><i data-lucide="upload" class="icon-md"></i> 파일을 놓아서 업로드</div>
          </div>
        </div>
      </div>

      <!-- Transfer Queue -->
      <div class="transfer-queue" id="transferQueue">
        <div class="queue-header">
          <span class="queue-title">
            <i data-lucide="arrow-up-down"></i>
            Transfers
            <span class="queue-count" id="queueCount">0</span>
          </span>
          <button class="btn-icon" onclick="clearCompletedTransfers()" title="Clear completed">
            <i data-lucide="trash-2"></i>
          </button>
        </div>
        <div class="queue-list" id="queueList">
          <div class="queue-empty">No transfers</div>
        </div>
      </div>

      <!-- 하단 상태바 -->
      <div class="sftp-status" id="sftpStatus">
        <span id="sftpStatusText">준비</span>
        <div class="sftp-progress-container" id="sftpProgressContainer" style="display: none;">
          <div class="sftp-progress-bar" id="sftpProgressBar"></div>
          <span class="sftp-progress-text" id="sftpProgressText">0%</span>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- SFTP 컨텍스트 메뉴 -->
  <div class="context-menu" id="sftpContextMenu" style="display: none;">
    <div class="context-menu-item" onclick="sftpDownloadSelected()"><i data-lucide="download" class="icon-sm"></i> 다운로드</div>
    <div class="context-menu-item" onclick="sftpRenameSelected()"><i data-lucide="edit-2" class="icon-sm"></i> 이름 변경</div>
    <div class="context-menu-item" onclick="sftpDeleteSelected()"><i data-lucide="trash-2" class="icon-sm"></i> 삭제</div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" onclick="sftpNewFolder()"><i data-lucide="folder-plus" class="icon-sm"></i> 새 폴더</div>
    <div class="context-menu-item" onclick="sftpRefresh()"><i data-lucide="refresh-cw" class="icon-sm"></i> 새로고침</div>
  </div>

  <!-- 로컬 컨텍스트 메뉴 -->
  <div class="context-menu" id="localContextMenu" style="display: none;">
    <div class="context-menu-item" onclick="localUploadSelected()"><i data-lucide="upload" class="icon-sm"></i> 원격으로 업로드</div>
    <div class="context-menu-item" onclick="localOpenInExplorer()"><i data-lucide="folder-open" class="icon-sm"></i> 탐색기에서 열기</div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" onclick="localRefresh()"><i data-lucide="refresh-cw" class="icon-sm"></i> 새로고침</div>
  </div>

  <!-- 상태바 -->
  <div class="statusbar">
    <span id="connectionStatus">연결 안 됨</span>
    <span class="spacer"></span>
    <span>UTF-8</span>
  </div>

  <!-- 연결 모달 -->
  <div class="modal-overlay" id="connectModal">
    <div class="modal">
      <div class="modal-header">
        <h2>새 SSH 연결</h2>
        <button class="btn-modal-close" onclick="hideConnectModal()"><i data-lucide="x" class="icon-sm"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>세션 이름</label>
          <input type="text" id="sessionName" placeholder="예: My Server">
        </div>
        <div class="form-group">
          <label>Session Icon</label>
          <div class="icon-selector" id="iconSelector">
            <button type="button" data-icon="server" class="icon-option selected"><i data-lucide="server"></i></button>
            <button type="button" data-icon="database" class="icon-option"><i data-lucide="database"></i></button>
            <button type="button" data-icon="cloud" class="icon-option"><i data-lucide="cloud"></i></button>
            <button type="button" data-icon="globe" class="icon-option"><i data-lucide="globe"></i></button>
            <button type="button" data-icon="home" class="icon-option"><i data-lucide="home"></i></button>
            <button type="button" data-icon="terminal" class="icon-option"><i data-lucide="terminal"></i></button>
            <button type="button" data-icon="shield" class="icon-option"><i data-lucide="shield"></i></button>
            <button type="button" data-icon="box" class="icon-option"><i data-lucide="box"></i></button>
          </div>
        </div>
        <div class="form-group">
          <label>폴더</label>
          <select id="sessionFolder">
            <option value="">루트 (폴더 없음)</option>
          </select>
        </div>
        <div class="form-group">
          <label>호스트</label>
          <input type="text" id="host" placeholder="예: 192.168.0.10">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>포트</label>
            <input type="number" id="port" value="22">
          </div>
          <div class="form-group">
            <label>사용자명</label>
            <input type="text" id="username" placeholder="예: root">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Connection Timeout (seconds)</label>
            <input type="number" id="connectTimeout" value="20" min="5" max="120" class="form-input">
          </div>
          <div class="form-group">
            <label>Keep-Alive Interval (seconds)</label>
            <input type="number" id="keepaliveInterval" value="30" min="10" max="300" class="form-input">
          </div>
        </div>
        <!-- 인증 방식 선택 -->
        <div class="form-group">
          <label>인증 방식</label>
          <div class="auth-type-selector">
            <label class="radio-label">
              <input type="radio" name="authType" value="password" checked onchange="toggleAuthType()">
              <span>비밀번호</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="authType" value="privateKey" onchange="toggleAuthType()">
              <span>Private Key</span>
            </label>
          </div>
        </div>

        <!-- 비밀번호 인증 필드 -->
        <div class="form-group auth-password">
          <label>비밀번호</label>
          <input type="password" id="password" placeholder="비밀번호 입력">
        </div>

        <!-- Private Key 인증 필드 -->
        <div class="form-group auth-privatekey" style="display: none;">
          <label>Private Key 파일</label>
          <div class="file-selector">
            <input type="text" id="privateKeyPath" placeholder="파일을 선택하세요" readonly>
            <button type="button" class="btn-file-select" onclick="selectPrivateKey()">찾아보기</button>
          </div>
        </div>
        <div class="form-group auth-privatekey" style="display: none;">
          <label>Passphrase (선택)</label>
          <input type="password" id="passphrase" placeholder="암호화된 키의 경우 입력">
        </div>

        <div class="form-check">
          <input type="checkbox" id="saveSession">
          <label for="saveSession">세션 저장</label>
        </div>
        <div class="form-check">
          <input type="checkbox" id="autoReconnect" checked>
          <label for="autoReconnect">Auto-reconnect on disconnect</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="hideConnectModal()">취소</button>
        <button class="btn-primary" onclick="connect()">연결</button>
      </div>
    </div>
  </div>

  <!-- 비밀번호 입력 모달 -->
  <div class="modal-overlay" id="passwordModal" style="display: none;">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h2 id="passwordModalTitle">비밀번호 입력</h2>
        <button class="btn-modal-close" onclick="cancelPasswordModal()"><i data-lucide="x" class="icon-sm"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label id="passwordModalLabel">비밀번호</label>
          <input type="password" id="passwordModalInput" placeholder="입력하세요">
        </div>
        <p id="passwordModalHint" class="hint" style="color: #888; font-size: 12px;"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="cancelPasswordModal()">취소</button>
        <button class="btn-primary" onclick="confirmPasswordModal()">확인</button>
      </div>
    </div>
  </div>

  <script src="../node_modules/xterm/lib/xterm.js"></script>
  <script src="../node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
  <script src="../node_modules/@xterm/addon-canvas/lib/addon-canvas.js"></script>
  <script src="renderer.js"></script>
  <script>
    lucide.createIcons();
  </script>
</body>
</html>
